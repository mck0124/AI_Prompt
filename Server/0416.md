# 0416

## ğŸ“˜ Advanced Result ë§¤í•‘ (MyBatis)

### ì£¼ìš” ìš”ì†Œ ìš”ì•½

- **constructor**: ê°ì²´ ìƒì„± ì‹œ ìƒì„±ìì˜ ì¸ì ì‚¬ìš©
    - `idArg`: ì‹ë³„ì ì—­í• ì˜ ì¸ì
    - `arg`: ì¼ë°˜ ì†ì„±ì— í•´ë‹¹í•˜ëŠ” ì¸ì
- **id**: ê¸°ë³¸ í‚¤(primary key)ë¡œ ì‚¬ìš©ë˜ëŠ” ì†ì„± ë§¤í•‘
- **result**: ì¼ë°˜ì ì¸ í•„ë“œ ë§¤í•‘
- **association**: ë³µí•© ì—°ê´€ê´€ê³„ (1:1)
    - `nested result mappings` ì‚¬ìš© ê°€ëŠ¥
- **collection**: ì§‘í•© ì—°ê´€ê´€ê³„ (1:N)
    - `nested result mapping` ì‚¬ìš© ê°€ëŠ¥
- **discriminator**: ì¡°ê±´ì— ë”°ë¼ ì„œë¡œ ë‹¤ë¥¸ resultMap ì‚¬ìš©
    - `case`: íŠ¹ì • ê°’ì— ë”°ë¼ ë¶„ê¸°

---

### ê³µí†µ ì†ì„±

| ì†ì„± | ì„¤ëª… |
| --- | --- |
| `column` | DBì˜ ì»¬ëŸ¼ëª… ë˜ëŠ” ë³„ì¹­ |
| `javaType` | ë§¤í•‘ë˜ëŠ” Java í´ë˜ìŠ¤ëª… ë˜ëŠ” íƒ€ì… |
| `jdbcType` | DBì— ì •ì˜ëœ JDBC íƒ€ì… (nullable ì»¬ëŸ¼ì— ëª…ì‹œ í•„ìš”) |
| `typeHandler` | Java <-> JDBC íƒ€ì… ë³€í™˜ ì‹œ ì‚¬ìš©í•˜ëŠ” í•¸ë“¤ëŸ¬ í´ë˜ìŠ¤ |

---

## âœ… id, result ì†ì„± ì˜ˆì‹œ

```xml
<id property="id" column="post_id"/>

```

- ë‹¨ì¼ ì†ì„±ì„ ê¸°ë³¸ì ìœ¼ë¡œ ë§¤í•‘í•  ë•Œ ì‚¬ìš©

| ì†ì„± | ì„¤ëª… |
| --- | --- |
| `property` | Java ê°ì²´ì˜ í•„ë“œëª… |

---

## ğŸ§± Constructor ê¸°ë°˜ ë§¤í•‘ ì˜ˆì‹œ

```xml
<constructor>
  <idArg column="id" javaType="string"/>
  <arg column="name" javaType="string"/>
</constructor>

```

```java
public class Author {
  private String id;
  private String name;

  public Author(String id, String name) {
    ...
  }
}

```

- ìƒì„±ìë¥¼ í†µí•´ ê°ì²´ë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ
- `@AllArgsConstructor` ë˜ëŠ” ëª…ì‹œì  ìƒì„±ì í•„ìš”

---

## ğŸ”— association (1:1 ê´€ê³„)

- has-a ê´€ê³„ë¥¼ í‘œí˜„
- ì¤‘ì²©ëœ ê°ì²´ ë§¤í•‘

### ë°©ì‹

- **Nested Select**: ë‹¤ë¥¸ SQL êµ¬ë¬¸ê³¼ ì—°ê´€
- **Nested Results**: join ê²°ê³¼ ì¤‘ì²© ë§¤í•‘

| ì†ì„± | ì„¤ëª… |
| --- | --- |
| `property` | Java ê°ì²´ í•„ë“œëª… |
| `select` | ë‹¤ë¥¸ SQLì˜ ID (ë³µí•©í‚¤ ì „ë‹¬ ì‹œ column="{prop1=col1, prop2=col2}") |
| `resultMap` | ì¤‘ì²© ë§¤í•‘ìš© resultMap ID |

```sql
create table blog(
	id number,
	title varchar2(50),
	content varchar2(200),
	author_id number
);

create table author(
    author_id number,
    name varchar2(50),
    address varchar2(50)
);

ALTER TABLE blog ADD CONSTRAINT blog_id_pk PRIMARY KEY(id);
ALTER TABLE author ADD CONSTRAINT author_author_id_pk PRIMARY KEY(author_id);
ALTER TABLE blog ADD CONSTRAINT blog_author_id_fk FOREIGN KEY(author_id) REFERENCES AUTHOR(author_id);

insert into author values(100, 'í™ê¸¸ë™', 'ì„œìš¸');
insert into author values(200, 'ë°•ê¸¸ë™', 'ì œì£¼');

insert into blog values(1, 'Java', 'good', 100);
insert into blog values(2, 'JSP', 'very good', 200);

commit;

```

---

## ğŸŒ± Spring í•µì‹¬ ìš”ì•½

| í•µì‹¬ ê°œë… | ì„¤ëª… |
| --- | --- |
| **IoC** | ê°ì²´ ìƒì„±ê³¼ ìƒëª…ì£¼ê¸°ë¥¼ ìŠ¤í”„ë§ì´ ê´€ë¦¬ |
| **DI** | í•„ìš”í•œ ì˜ì¡´ ê°ì²´ë¥¼ ìë™ ì£¼ì… |
| **AOP** | ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì½”ë“œ ëª¨ë“ˆí™” |
| **POJO** | ìˆœìˆ˜ Java ê°ì²´ ê¸°ë°˜ ê°œë°œ |

---

## ğŸ“¦ ApplicationContext.xml ì˜ˆì‹œ

```xml
<context:component-scan base-package="kosa.di"/>

```

- `@Component`, `@Service`, `@Repository`, `@Controller` ë“± ìë™ ê°ì§€

---

## ğŸ’¾ XML ë°©ì‹ DI ì˜ˆì‹œ

```xml
<bean id="oracleDao" class="kosa.di.OracleDao"/>
<bean id="mySQLDao" class="kosa.di.MySQLDao"/>

<bean id="writeService" class="kosa.di.WriteService">
  <constructor-arg ref="oracleDao"/>
  <property name="dao" ref="mySQLDao"/>
</bean>

```

- ìƒì„±ìì™€ setter ë™ì‹œ ì£¼ì… ì˜ˆì‹œ

---

## â˜• Java í´ë˜ìŠ¤ êµ¬í˜„ ì˜ˆì‹œ

### Dao.java

```java
public interface Dao {
  void insertBoard();
}

```

### OracleDao.java

```java
@Repository
public class OracleDao implements Dao {
  public void insertBoard() {
    System.out.println("OracleDao insertBoard() í˜¸ì¶œ");
  }
}

```

### MySQLDao.java

```java
@Repository
public class MySQLDao implements Dao {
  public void insertBoard() {
    System.out.println("MySQLDao insertBoard() í˜¸ì¶œ");
  }
}

```

### WriteService.java

```java
@Service
public class WriteService {
  @Autowired
  private Dao dao;

  public WriteService() {}

  public WriteService(Dao dao) {
    this.dao = dao;
  }

  public void insertService() {
    System.out.println("WriteService insertService() í˜¸ì¶œ");
    dao.insertBoard();
  }

  public Dao getDao() { return dao; }
  public void setDao(Dao dao) { this.dao = dao; }
}

```

### Factory.java (Java ê¸°ë°˜ ì„¤ì •)

```java
@Configuration
public class Factory {
  @Bean
  public Dao oracleDao() {
    return new OracleDao();
  }

  @Bean
  public WriteService writeService() {
    return new WriteService();
  }
}

```

### Main.java

```java
public class Main {
  public static void main(String[] args) {
    ApplicationContext factory = new AnnotationConfigApplicationContext(Factory.class);
    WriteService service = factory.getBean("writeService", WriteService.class);
    service.insertService();
  }
}

```

---

## ğŸ”¤ Bean ì´ë¦„ ê·œì¹™

| ì„¤ì • ì˜ˆ | Bean ID |
| --- | --- |
| `@Component` on `OracleDao` | `oracleDao` (ìë™ ì†Œë¬¸ì ë³€í™˜) |
| `@Component("myDao")` | `myDao` (ì§ì ‘ ì§€ì • ê°€ëŠ¥) |

---